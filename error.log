{"error":"Internal Server Error","detail":"(sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"date_of_birth\" of relation \"patients\" violates not-null constraint\nDETAIL:  Failing row contains (e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, ORG-2026-000001-1254, d92731e5-742b-4b83-992d-050af97e8dbc, gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJ..., null, null, gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_yS..., gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqV..., {}, {}, , [], [], e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, 2026-01-28 18:09:45.338935, 2026-01-28 18:09:45.338935, null).\n[SQL: INSERT INTO patients (id, mrn, organization_id, full_name, date_of_birth, gender, phone_number, email, address, emergency_contact, medical_history, allergies, medications, created_by, deleted_at) VALUES ($1::UUID, $2::VARCHAR, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSONB, $10::JSONB, $11::VARCHAR, $12::JSONB, $13::JSONB, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE) RETURNING patients.created_at, patients.updated_at]\n[parameters: (UUID('e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13'), 'ORG-2026-000001-1254', UUID('d92731e5-742b-4b83-992d-050af97e8dbc'), 'gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJHM2zRQl2nQVfOS_anm3ZAxqJFPPbGq1P3wj8D0MVKV1hSyBJZKZdhqo=', None, None, 'gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_ySRVlQbdhQfLnaHnaoRAj-knIo0Dw1nXGGYw==', 'gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqVzMY9j1yYUoem9tmvI2Pj4CTVHdtjq9MHT93DTbz1hssPiucn6w8HFvY=', '{}', '{}', '', '[]', '[]', UUID('e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13'), None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)","traceback":"Traceback (most recent call last):\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 546, in _prepare_and_execute\n    self._rows = await prepared_stmt.fetch(*parameters)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 176, in fetch\n    data = await self.__bind_execute(args, 0, timeout)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 241, in __bind_execute\n    data, status, _ = await self.__do_execute(\n                      ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py\", line 230, in __do_execute\n    return await executor(protocol)\n           ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"asyncpg/protocol/protocol.pyx\", line 207, in bind_execute\nasyncpg.exceptions.NotNullViolationError: null value in column \"date_of_birth\" of relation \"patients\" violates not-null constraint\nDETAIL:  Failing row contains (e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, ORG-2026-000001-1254, d92731e5-742b-4b83-992d-050af97e8dbc, gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJ..., null, null, gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_yS..., gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqV..., {}, {}, , [], [], e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, 2026-01-28 18:09:45.338935, 2026-01-28 18:09:45.338935, null).\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 130, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 195, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 509, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 797, in _handle_exception\n    raise translated_error from error\nsqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.IntegrityError: <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"date_of_birth\" of relation \"patients\" violates not-null constraint\nDETAIL:  Failing row contains (e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, ORG-2026-000001-1254, d92731e5-742b-4b83-992d-050af97e8dbc, gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJ..., null, null, gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_yS..., gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqV..., {}, {}, , [], [], e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, 2026-01-28 18:09:45.338935, 2026-01-28 18:09:45.338935, null).\n\nThe above exception was the direct cause of the following exception:\n\nTraceback (most recent call last):\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/errors.py\", line 164, in __call__\n    await self.app(scope, receive, _send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/base.py\", line 189, in __call__\n    with collapse_excgroups():\n  File \"/usr/local/lib/python3.11/contextlib.py\", line 158, in __exit__\n    self.gen.throw(typ, value, traceback)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/_utils.py\", line 91, in collapse_excgroups\n    raise exc\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/base.py\", line 191, in __call__\n    response = await self.dispatch_func(request, call_next)\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/middleware/validation.py\", line 25, in dispatch\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/base.py\", line 165, in call_next\n    raise app_exc\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/base.py\", line 151, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/cors.py\", line 83, in __call__\n    await self.app(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py\", line 62, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/routing.py\", line 762, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/routing.py\", line 782, in app\n    await route.handle(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/routing.py\", line 297, in handle\n    await self.app(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/routing.py\", line 77, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 64, in wrapped_app\n    raise exc\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/opt/venv/lib/python3.11/site-packages/starlette/routing.py\", line 72, in app\n    response = await func(request)\n               ^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/fastapi/routing.py\", line 299, in app\n    raise e\n  File \"/opt/venv/lib/python3.11/site-packages/fastapi/routing.py\", line 294, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/fastapi/routing.py\", line 191, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app/api/v1/auth.py\", line 149, in register\n    await patient_service.create_patient(\n  File \"/app/app/services/patient_service.py\", line 191, in create_patient\n    await self.db.flush() # Get ID\n    ^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py\", line 802, in flush\n    await greenlet_spawn(self.sync_session.flush, objects=objects)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 202, in greenlet_spawn\n    result = context.switch(value)\n             ^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4312, in flush\n    self._flush(objects)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4447, in _flush\n    with util.safe_reraise():\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py\", line 146, in __exit__\n    raise exc_value.with_traceback(exc_tb)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py\", line 4408, in _flush\n    flush_context.execute()\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 466, in execute\n    rec.execute(self)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py\", line 642, in execute\n    util.preloaded.orm_persistence.save_obj(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 93, in save_obj\n    _emit_insert_statements(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py\", line 1227, in _emit_insert_statements\n    result = connection.execute(\n             ^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1416, in execute\n    return meth(\n           ^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/sql/elements.py\", line 517, in _execute_on_connection\n    return connection._execute_clauseelement(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1639, in _execute_clauseelement\n    ret = self._execute_context(\n          ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1848, in _execute_context\n    return self._exec_single_context(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1988, in _exec_single_context\n    self._handle_dbapi_exception(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 2344, in _handle_dbapi_exception\n    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py\", line 1969, in _exec_single_context\n    self.dialect.do_execute(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py\", line 922, in do_execute\n    cursor.execute(statement, parameters)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 580, in execute\n    self._adapt_connection.await_(\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 130, in await_only\n    return current.driver.switch(awaitable)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py\", line 195, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 558, in _prepare_and_execute\n    self._handle_exception(error)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 509, in _handle_exception\n    self._adapt_connection._handle_exception(error)\n  File \"/opt/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py\", line 797, in _handle_exception\n    raise translated_error from error\nsqlalchemy.exc.IntegrityError: (sqlalchemy.dialects.postgresql.asyncpg.IntegrityError) <class 'asyncpg.exceptions.NotNullViolationError'>: null value in column \"date_of_birth\" of relation \"patients\" violates not-null constraint\nDETAIL:  Failing row contains (e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, ORG-2026-000001-1254, d92731e5-742b-4b83-992d-050af97e8dbc, gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJ..., null, null, gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_yS..., gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqV..., {}, {}, , [], [], e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13, 2026-01-28 18:09:45.338935, 2026-01-28 18:09:45.338935, null).\n[SQL: INSERT INTO patients (id, mrn, organization_id, full_name, date_of_birth, gender, phone_number, email, address, emergency_contact, medical_history, allergies, medications, created_by, deleted_at) VALUES ($1::UUID, $2::VARCHAR, $3::UUID, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR, $7::VARCHAR, $8::VARCHAR, $9::JSONB, $10::JSONB, $11::VARCHAR, $12::JSONB, $13::JSONB, $14::UUID, $15::TIMESTAMP WITHOUT TIME ZONE) RETURNING patients.created_at, patients.updated_at]\n[parameters: (UUID('e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13'), 'ORG-2026-000001-1254', UUID('d92731e5-742b-4b83-992d-050af97e8dbc'), 'gAAAAABpelDpeCCqNXK15M41X2tS1OgTu-PUpIuF6APWPFxN8g44TdYSmr_T0_yJHM2zRQl2nQVfOS_anm3ZAxqJFPPbGq1P3wj8D0MVKV1hSyBJZKZdhqo=', None, None, 'gAAAAABpelDpTPuAp4luWlpfw2vlr4vziMaIc2VFTZ052Ip7Dp7q6_d5VFfSx_ySRVlQbdhQfLnaHnaoRAj-knIo0Dw1nXGGYw==', 'gAAAAABpelDpvYBxhoiUWiiZYGVTPDuESG90O1FJ6S3qDioOpRZS0_ErXz2qUrqVzMY9j1yYUoem9tmvI2Pj4CTVHdtjq9MHT93DTbz1hssPiucn6w8HFvY=', '{}', '{}', '', '[]', '[]', UUID('e28ba0fc-d820-4cde-b7f1-bfd22cfc2b13'), None)]\n(Background on this error at: https://sqlalche.me/e/20/gkpj)\n"}